ButtonToggleCount = 0
ButtonToggleColor = false


AchievementList = {

    MolotovAchievements = {"You Fired!","Throw a Molotov Cocktail at some zombies"},
    GoOutSide = {"The Adventure begins","Summon the courage to go outside for the first time and start your journey"},
    Grim = {"A Grim Realization","Spot 100 zombies at one time"},
    KillZ1 = {"Kill a Zombie","You battled with a zombie and won"},
    KillZ2 = {"Kill 100 Zombies","Your getting the hang of these things"},
    KillZ3 = {"Kill 1000 Zombies!","You no longer fear them"},
    KillZ4 = {"Kill 10000 Zombies!","You are the master of the dead"},
    Naked = {"Get Naked","I don\'t know what it is your trying to do, but good for you."},
    PencilKill = {"Schools out forever","Kill a zombie with a pencil"},
    AllPenKill = {"I always wanted to be a cartoonist","Kill a zombie with four different pen colors."},
    ForkKill = {"Dinner is served","Kill A zombie With a Fork"},
    Survive1 = {"Freshman","Just live through 1 day"},
    Survive2 = {"That\'s a start","Live through 30 days"},
    Survive3 = {"Happy new year","Survive 1 whole year of the Apocholypse"},
    level1 = {"I\'m Learning!","Level up any skill to level 1"},
    level2 = {"Masters Degree","Level up any skill to level 10"},
    Spiffo = {"I found You!","Find a Spiffo Doll"},
    Cube = {"I don\'t need these things","Find a Rubix Cube, Rubber ducky, Football, Yoyo and a CatToy"},
    Shoot = {"I regret doing that","Shoot a gun"},
    Train = {"Chuga Chuga Choo Choo","Visit the Muldrough Train Station"},
    LostCabin = {"Where the H*LL am I!?","Find the Isolated Cabin in Dixie"},
    ChurchGoer = {"Church Goer","Visit All 8 Churches on the base game map"},
    Cricket = {"Chirp Chirp?","Catch a Cricket"},
    DeadSquirrel = {"Look a Squirrel!","Catch a Squirrel dead or alive!.... preferably dead"},    
    Mushrooms = {"Mushroom Maniac","Find all 7 kinds of mushrooms"},
    Fish = {"Catfish","Catch a Catfish"},    
    CraftSpikeBat = {"The Bare Necessities","Build a Spiked Bat"},
    CraftNoiseMaker = {"Hell Raiser","Make a Noise Maker"},    
    GetBit = {"How did I taste?","Let one of our fine friends just take one little bite...just a little one."},
    LiarLiar = {"Liar Liar Pants on Fire","Set your pants on fire...and no do NOT take them off first!"},
    Drunk = {"Just one more","Get yourself, totally, wasted"},
    Hunter = {"Zombie Hunter","Snipe 100 Zombies with a Hunting Rifle"},
    Dire = {"In Dire Straits","Be starving and dying of thirst at the same time"},
    Poison = {"I don\'t feel so good", "You just poisoned yourself pretty good. Will you survive? Poison yourself with poison level of 25 or more. It is survivable."},
    Macho = {"Macho Man", "Pick up something very heavy (at least 40 pounds) in both hands and carry it 200 squares distance away"},
    Unarmed = {"I AM THE WEAPON", "Don\'t try it, you\'re not ready"},
    SpiffoRest = {"Would you like a Spiffo with that?", "Pay a visit to every Spiffos restaurant on the map"},
    Safe = {"Safe at last?", "Barricade a total of 100 planks onto windows"},
    Medic = {"Field Medic", "Apply a total of 50 bandages to injuries"},
    RIP = {"R.I.P", "Burry a Corpse"},
    Chocolate = {"Mmmmm...Chocolate", "Eat 25 bars of Chocolate"},
    BurnCorpse = {"Look what I have created !", "Start a fire by burning a Corpse (with lighter and gas can)"},
    ReadASkillBook = {"Book Worm", "Read a total of 15 Skill books"},
    EatWorm = {"Desperate Times", "Eat a Worm"},
    Blunt = {"Blunt Master", "Kill 500 zombies with Long Blunt type weapons"},
    SmallBlade = {"I like it close and personal", "Kill 500 zombies with one handed blade type weapons"},
    SmallBlunt = {"Let me build in peace !", "Kill 500 zombies with one handed blunt type weapons"},
    Blade = {"Blade Master", "Kill 500 zombies with two handed blade type weapons"},
    Axin = {"Can I Axe you some questions?","Kill 500 zombies with an Axe"},
    Inspeared = {"Feeling inspeared","Kill 500 zombies with a Spear"},
    Survivalist = {"Survivalist", "Craft a Campfire kit, Tent Kit, Stone Hammer and a Stone Axe"},
    Bleach = {"Grand Finale", "Drink Bleach...Make sure you have done whatever you need to do before you do this..."},
    Vandal = {"Vandal", "Smash 100 Windows (with right click menu)"},
    Light = {"Let there be Light!", "Set up and activate a Generator"},
    ReturnSpiffo = {"Returning to the holy land", "Bring a Spiffo doll to a Spiffos restaurant (place on floor)"},
}


TrainStationWP = {
sx = 11563,
sy = 9592 ,
ex = 11742,
ey = 10184,
}

IsolatedCabin = {
sx = 13630,
sy = 7222 ,
ex = 13634,
ey = 7227,
}



ChurchCheckPoints = {

    Church1 = {--Muldraugh Church
        sx = 10770,
        sy = 10161,
        ex = 10790,
        ey = 10178,
    },
    Church2 = {--Academy (North East)
        sx = 12843,
        sy = 4949,
        ex = 12869,
        ey = 4966,
    },
    Church3 = {--East Graveyard Church
        sx = 14551,
        sy = 4959,
        ex = 14587,
        ey = 4987,
    },
    Church4 = {--Wespoint Cemetary
        sx = 11055,
        sy = 6702,
        ex = 11102,
        ey = 6725,
    },
    Church5 = {--Wespoint Church
        sx = 11958,
        sy = 6975,
        ex = 11987,
        ey = 7009,
    },
    Church6 = {--Rosewood Church
        sx = 8119,
        sy = 11538,
        ex = 8146,
        ey = 11562,
    },
    Church7 = {--March Ridge Church
        sx = 10320,
        sy = 12779,
        ex = 10346,
        ey = 12816,
    },
    Church8 = {--Riverside Church
        sx = 6556,
        sy = 5364,
        ex = 6586,
        ey = 5383,
    },
    
}
SpiffoCheckPoints = {

    Spiffo1 = {
        sx = 10616,
        sy = 9644,
        ex = 10633,
        ey = 9662,
    },
    Spiffo2 = {
        sx = 11971,
        sy = 6804,
        ex = 11988,
        ey = 6821,
    },
    Spiffo3 = {
        sx = 8064,
        sy = 11334,
        ex = 8081,
        ey = 11357,
    },
    Spiffo4 = {
        sx = 6114,
        sy = 5299,
        ex = 6135,
        ey = 5316,
    },
    Spiffo5 = {
        sx = 11662,
        sy = 8294,
        ex = 11677,
        ey = 8313,
    },
    
    
}

StuffDontNeed = {"Cube", "CatToy", "Rubberducky", "Football", "Yoyo"}
AllMushrooms = { "MushroomGeneric1", "MushroomGeneric2", "MushroomGeneric3", "MushroomGeneric4", "MushroomGeneric5", "MushroomGeneric6","MushroomGeneric7"}
SurvivalistItems = { "CampingTentKit", "CampfireKit", "AxeStone", "HammerStone"}

function ItemGatherTracker(player,ItemList,Achievement)
    if(MyAchievementManager:isComplete(Achievement)) then return false end
    
    local PCP = player:getModData().CheckPoints
    local checkpointcount = 0
    local total = 0
    for i, v in ipairs(ItemList) do
        total = total + 1
        if(PCP[v]) then
            checkpointcount = checkpointcount + 1
        end
    end
    
    for i, v in ipairs(ItemList) do
        if(not PCP[v]) then
            if (PlayerHasItem(player,v)) then
                checkpointcount = checkpointcount + 1
                PCP[v] = true;
                --player:Say("Found "  .. v .. "! " .. Achievement .. " Achievement " .. tostring(checkpointcount) .. "/" .. tostring(total) .. " " .. " cleared.");
                MyAchievementManager:SetBannerMSG("Found "  .. v .. "! \"" .. MyAchievementManager:getDisplayName(Achievement) .. "\" Achievement " .. tostring(checkpointcount) .. "/" .. tostring(total) .. " " .. " cleared.")
                if(checkpointcount == total) then MyAchievementManager:setComplete(Achievement,true) end
            end
        end
    end
    player:getModData().CheckPointCounts[Achievement] = checkpointcount
    
end

function ItemCraftTracker(player,ItemList,Achievement)
    if(MyAchievementManager:isComplete(Achievement)) then return false end
    
    local PCP = player:getModData().CheckPoints
    local checkpointcount = 0
    local total = 0
    for i, v in ipairs(ItemList) do
        total = total + 1
        if(PCP[v]) then
            checkpointcount = checkpointcount + 1
        end
    end
    
    for i, v in ipairs(ItemList) do
        if(not PCP[v]) then
            if (player:getModData().ThingsICrafted[v] ~= nil) and (player:getModData().ThingsICrafted[v]  >= 1) then
                checkpointcount = checkpointcount + 1
                PCP[v] = true;
                --player:Say("Found "  .. v .. "! " .. Achievement .. " Achievement " .. tostring(checkpointcount) .. "/" .. tostring(total) .. " " .. " cleared.");
                MyAchievementManager:SetBannerMSG("Crafted "  .. v .. "! \"" .. MyAchievementManager:getDisplayName(Achievement) .. "\" Achievement " .. tostring(checkpointcount) .. "/" .. tostring(total) .. " " .. " cleared.")
                if(checkpointcount == total) then MyAchievementManager:setComplete(Achievement,true) end
            end
        end
    end
    player:getModData().CheckPointCounts[Achievement] = checkpointcount

end

function CheckPointTracker(player,CP,Achievement)
    if(MyAchievementManager:isComplete(Achievement)) then return false end
    
    local PCP = player:getModData().CheckPoints
    local checkpointcount = 0
    local total = 0
    for k, v in pairs(CP) do
        total = total + 1
        if(PCP[k]) then
            checkpointcount = checkpointcount + 1
        end
    end
    
    for k, v in pairs(CP) do
        if(not PCP[k]) then
            if (InLocation(player,v)) then
                checkpointcount = checkpointcount + 1
                PCP[k] = true;
                --player:Say("CheckPoint " .. tostring(checkpointcount) .. "/" .. tostring(total) .. " " .. tostring(k) .. " cleared.");
                MyAchievementManager:SetBannerMSG("Achievement \"".. MyAchievementManager:getDisplayName(Achievement) .. "\" CheckPoint " .. tostring(checkpointcount) .. "/" .. tostring(total) .. " " .. tostring(k) .. " cleared.")
                if(checkpointcount == total) then MyAchievementManager:setComplete(Achievement,true) end
            end
        end
    end
    player:getModData().CheckPointCounts[Achievement] = checkpointcount
    
end

function InOneOfTheseLocations(player,Locations)
            
    for k, v in pairs(Locations) do        
        if (InLocation(player,v)) then
            return true
        end
    end
    return false
    
end

function InLocation(player,loc)

    local x = player:getX()
    local y = player:getY()
    if(x > loc.sx) and (x < loc.ex) and (y > loc.sy) and (y < loc.ey) then
        return true
    else
        return false
    end
    
end

function AchievementsInit(player)
    if player == nil then
        player = getPlayer()
    end
    if(player:getModData().Achievements == nil) then 
        player:getModData().Achievements = {} 
        player:getModData().StartingTime = getGameTime():getWorldAgeHours();
    end
    if(player:getModData().CheckPoints == nil) then 
        player:getModData().CheckPoints = {} 
    end
    if(player:getModData().ThingsIDropped == nil) then 
        player:getModData().ThingsIDropped = {} 
    end
    if(player:getModData().CheckPointCounts == nil) then 
        player:getModData().CheckPointCounts = {} 
    end
    if(player:getModData().KilledWithWeaponCounts == nil) then 
        player:getModData().KilledWithWeaponCounts = {} 
    end    
    if(player:getModData().KilledWithWeaponCategoryCounts == nil) then 
        player:getModData().KilledWithWeaponCategoryCounts = {} 
    end    
    if(player:getModData().ThingsIDid == nil) then
        player:getModData().ThingsIDid = {}
    end
    if(player:getModData().ThingsIAte == nil) then
        player:getModData().ThingsIAte = {}
    end
    if(player:getModData().ThingsICrafted == nil) then
        player:getModData().ThingsICrafted = {}
    end
    AchievementsWindowCreate()
    AchievementDescWindowCreate()
    
    if not MyAchievementManager then MyAchievementManager = AchievementManager:new(); end
    
    --print("achievements added")
    
    myAchievementsWindow:Update()
    MyAchievementManager:update()

end
Events.OnGameStart.Add(AchievementsInit);

LoopReducer = 0
distanceCarried = 0
function AchievementOnPlayerUpdate(player)    
    if(player:isLocalPlayer()) then
        LoopReducer = LoopReducer + 1
        if(LoopReducer == 30) then
            LoopReducer = 0
            
            if player:getModData().ThingsIDid == nil then
                AchievementsInit(player);--init for characters continuing game. this should also clear ALL done achievements
            end
            
            if(ButtonToggle) then 
                
                ButtonToggleColor = not ButtonToggleColor
                if(ButtonToggleColor) then AchievementButton:setImage(TrophyTextureOff);
                else AchievementButton:setImage(TrophyTextureOn); end
            end
            
            if(not MyAchievementManager:isComplete("GoOutSide")) and (player:isOutside()) then MyAchievementManager:setComplete("GoOutSide",true) end
            if(not MyAchievementManager:isComplete("Grim")) and (CanSeeNumber(player) >= 100) then MyAchievementManager:setComplete("Grim",true) end
            
            if(not MyAchievementManager:isComplete("KillZ1")) and (player:getZombieKills() >= 1) then MyAchievementManager:setComplete("KillZ1",true) end
            if(not MyAchievementManager:isComplete("KillZ2")) and (player:getZombieKills() >= 100) then MyAchievementManager:setComplete("KillZ2",true) end
            if(not MyAchievementManager:isComplete("KillZ3")) and (player:getZombieKills() >= 1000) then MyAchievementManager:setComplete("KillZ3",true) end
            if(not MyAchievementManager:isComplete("KillZ4")) and (player:getZombieKills() >= 10000) then MyAchievementManager:setComplete("KillZ4",true) end
            
            if(not MyAchievementManager:isComplete("Naked")) and (player:getClothingItem_Back() == nil and player:getClothingItem_Feet() == nil and player:getClothingItem_Hands() == nil and player:getClothingItem_Head() == nil and player:getClothingItem_Legs() == nil and player:getClothingItem_Torso() == nil) then MyAchievementManager:setComplete("Naked",true) end
            
            if(not MyAchievementManager:isComplete("Survive1")) and (player:getHoursSurvived() >= 24) then MyAchievementManager:setComplete("Survive1",true) end
            if(not MyAchievementManager:isComplete("Survive2")) and (player:getHoursSurvived() >= (24 * 29.53)) then MyAchievementManager:setComplete("Survive2",true) end
            if(not MyAchievementManager:isComplete("Survive3")) and (player:getHoursSurvived() >= ((24 * 29.53) * 12)) then MyAchievementManager:setComplete("Survive3",true) end
            
            if(not MyAchievementManager:isComplete("Spiffo")) and ( PlayerHasItem(player,"Spiffo") ) then MyAchievementManager:setComplete("Spiffo",true) end
            if(not MyAchievementManager:isComplete("Cricket")) and ( PlayerHasItem(player,"Cricket") ) then MyAchievementManager:setComplete("Cricket",true) end
            if(not MyAchievementManager:isComplete("DeadSquirrel")) and ( PlayerHasItem(player,"DeadSquirrel") ) then MyAchievementManager:setComplete("DeadSquirrel",true) end
            if(not MyAchievementManager:isComplete("Fish")) and ( PlayerHasItem(player,"Catfish") ) and (player:getPrimaryHandItem() ~= nil and string.find(player:getPrimaryHandItem():getType(), "FishingRod")) then MyAchievementManager:setComplete("Fish",true) end
            
            if(not MyAchievementManager:isComplete("Train")) and ( InLocation(player,TrainStationWP) ) then MyAchievementManager:setComplete("Train",true) end
            if(not MyAchievementManager:isComplete("LostCabin")) and ( InLocation(player,IsolatedCabin) ) then MyAchievementManager:setComplete("LostCabin",true) end
            if(not MyAchievementManager:isComplete("ReturnSpiffo")) and ( InOneOfTheseLocations(player,SpiffoCheckPoints)) then 
                if( SpiffosDroppedCount == nil ) then
                    SpiffosDroppedCount = player:getModData().ThingsIDropped["Spiffo"]
                    if(SpiffosDroppedCount == nil) then SpiffosDroppedCount = 0 end
                else
                    local tempSpiffoDroppedCount = player:getModData().ThingsIDropped["Spiffo"]
                    if(tempSpiffoDroppedCount == nil) then tempSpiffoDroppedCount = 0 end
                    
                    if(tempSpiffoDroppedCount > SpiffosDroppedCount) then -- spiffo was dropped in spiffos!
                        MyAchievementManager:setComplete("ReturnSpiffo",true) 
                    end
                end
                
            else
                SpiffosDroppedCount = nil
            end
            
            if(not MyAchievementManager:isComplete("GetBit")) and ( player:getBodyDamage():getNumPartsBitten() >= 1 ) then MyAchievementManager:setComplete("GetBit",true) end
            if(not MyAchievementManager:isComplete("LiarLiar")) and ( player:getBodyDamage():IsOnFire() ) then MyAchievementManager:setComplete("LiarLiar",true) end
            
            if(not MyAchievementManager:isComplete("Safe")) and ( player:getModData().ThingsIDid["Barricade"] ~= nil and player:getModData().ThingsIDid["Barricade"] >= 100 ) then MyAchievementManager:setComplete("Safe",true) end
            if(not MyAchievementManager:isComplete("Medic")) and ( player:getModData().ThingsIDid["bandage"] ~= nil and player:getModData().ThingsIDid["bandage"] >= 50 ) then MyAchievementManager:setComplete("Medic",true) end
            if(not MyAchievementManager:isComplete("Vandal")) and ( player:getModData().ThingsIDid["SmashWindow"] ~= nil and player:getModData().ThingsIDid["SmashWindow"] >=100 ) then MyAchievementManager:setComplete("Vandal",true) end
            if(not MyAchievementManager:isComplete("Light")) and ( player:getModData().ThingsIDid["ActivateGenerator"] ~= nil and player:getModData().ThingsIDid["ActivateGenerator"] >=1 ) then MyAchievementManager:setComplete("Light",true) end
            if(not MyAchievementManager:isComplete("RIP")) and ( player:getModData().ThingsIDid["BuryCorpse"] ~= nil and player:getModData().ThingsIDid["BuryCorpse"] >= 1 ) then MyAchievementManager:setComplete("RIP",true) end
            if(not MyAchievementManager:isComplete("ReadASkillBook")) and ( player:getModData().ThingsIDid["ReadASkillBook"] ~= nil and player:getModData().ThingsIDid["ReadASkillBook"] >= 15 ) then MyAchievementManager:setComplete("ReadASkillBook",true) end
            if(not MyAchievementManager:isComplete("BurnCorpse")) and ( player:getModData().ThingsIDid["BurnCorpse"] ~= nil and player:getModData().ThingsIDid["BurnCorpse"] >= 1 ) then MyAchievementManager:setComplete("BurnCorpse",true) end
            if(not MyAchievementManager:isComplete("Chocolate")) and ( player:getModData().ThingsIAte["Chocolate"] ~= nil and player:getModData().ThingsIAte["Chocolate"] >= 25 ) then MyAchievementManager:setComplete("Chocolate",true) end
            if(not MyAchievementManager:isComplete("EatWorm")) and ( player:getModData().ThingsIAte["Worm"] ~= nil and player:getModData().ThingsIAte["Worm"] >= 1 ) then MyAchievementManager:setComplete("EatWorm",true) end
            if(not MyAchievementManager:isComplete("Poison")) and ( player:getBodyDamage():getPoisonLevel() >= 25 ) then MyAchievementManager:setComplete("Poison",true) end
            if(not MyAchievementManager:isComplete("Bleach")) and ( player:getModData().ThingsIAte["Bleach"] ~= nil and player:getModData().ThingsIAte["Bleach"] >= 1 ) then MyAchievementManager:setComplete("Bleach",true) end
            
            
            local moodles = player:getMoodles()            
            if(not MyAchievementManager:isComplete("Drunk")) and ( moodles:getMoodleLevel(MoodleType.Drunk) >= 4 ) then MyAchievementManager:setComplete("Drunk",true) end
            if(not MyAchievementManager:isComplete("Dire")) and ( moodles:getMoodleLevel(MoodleType.Hungry) >= 4 ) and ( moodles:getMoodleLevel(MoodleType.Thirst) >= 4 ) then MyAchievementManager:setComplete("Dire",true) end
            
            if(not MyAchievementManager:isComplete("Macho")) and ( player:getPrimaryHandItem() ~= nil) and ( player:getSecondaryHandItem() ~= nil) and ((player:getPrimaryHandItem():getActualWeight() >= 40) or (player:getSecondaryHandItem():getActualWeight() >= 40)) then 
                if(not StartedCarryingX) then
                    StartedCarryingX = player:getX()
                    StartedCarryingY = player:getY()
                end
                local distanceX = (player:getX() - StartedCarryingX);
                local distanceY = (player:getY() - StartedCarryingY);
                distanceCarried = math.sqrt(distanceX*distanceX+distanceY*distanceY);
                if(distanceCarried >= 200) then MyAchievementManager:setComplete("Macho",true) end
            else 
                StartedCarryingX = nil
                StartedCarryingY = nil
                distanceCarried = 0
            end
            --player:Say(tostring(moodles:getMoodleLevel(MoodleType.Hungry)) .. "," .. tostring(moodles:getMoodleLevel(MoodleType.Thirst)))
            --player:Say(tostring(player:getBodyDamage():getPoisonLevel()))
            
            CheckPointTracker(player,ChurchCheckPoints,"ChurchGoer")
            CheckPointTracker(player,SpiffoCheckPoints,"SpiffoRest")
            
            ItemGatherTracker(player,AllMushrooms,"Mushrooms")
            ItemGatherTracker(player,StuffDontNeed,"Cube")
            
            ItemCraftTracker(player,SurvivalistItems,"Survivalist")
            
            if(not MyAchievementManager:isComplete("CraftSpikeBat")) and (player:getModData().ThingsICrafted["BaseballBatNails"] ~= nil) and (player:getModData().ThingsICrafted["BaseballBatNails"]  >= 1) then MyAchievementManager:setComplete("CraftSpikeBat",true) end
            if(not MyAchievementManager:isComplete("CraftNoiseMaker")) and (player:getModData().ThingsICrafted["NoiseTrap"] ~= nil) and (player:getModData().ThingsICrafted["NoiseTrap"]  >= 1) then MyAchievementManager:setComplete("CraftNoiseMaker",true) end
                
            MyAchievementManager:update()
            
        
        end
    end    
end
Events.OnPlayerUpdate.Add(AchievementOnPlayerUpdate);


function AchievementOnWeaponSwing(player)
    if( not player:isLocalPlayer()) then return false end
    local primaryHandItem = player:getPrimaryHandItem()
    if not primaryHandItem then return false end
    
    if(not MyAchievementManager:isComplete("MolotovAchievements")) and (CanSeeNumber(player) > 0) and (tostring(primaryHandItem:getType()) == "Molotov") then MyAchievementManager:setComplete("MolotovAchievements",true) end
    if(not MyAchievementManager:isComplete("Shoot")) and (instanceof(primaryHandItem,"HandWeapon")) and (primaryHandItem:isAimedFirearm())  then MyAchievementManager:setComplete("Shoot",true) end
end
Events.OnWeaponSwing.Add(AchievementOnWeaponSwing);


function AchievementOnWeaponHitCharacter(wielder, victim, weapon, damage)
    if(not wielder or not instanceof(wielder, "IsoPlayer") or not wielder:isLocalPlayer()) then return false end
    if(wielder == getPlayer()) then 
        LastThingIHit = victim 
        LastWeaponIUsed = weapon
        
        --if(not MyAchievementManager:isComplete("SneakAttack")) and (tostring(victim:getCurrentState()) == "zombie.ai.states.ZombieStand@62b72289") and (wielder:getPrimaryHandItem() ~= nil) and (instanceof(wielder:getPrimaryHandItem(),"HandWeapon")) and (not wielder:getPrimaryHandItem():isRanged())  then MyAchievementManager:setComplete("SneakAttack",true) end
    
        
    end
            
end
Events.OnWeaponHitCharacter.Add(AchievementOnWeaponHitCharacter);


--TODO compatibility with KllCount doing the count down
function AchievementOnZombieDead(zombie)
    if(LastThingIHit ~= nil) and (zombie == LastThingIHit) and (LastWeaponIUsed ~= nil) then
        local killedcounts = getPlayer():getModData().KilledWithWeaponCounts
        local killedcatcounts = getPlayer():getModData().KilledWithWeaponCategoryCounts
        if(killedcounts[LastWeaponIUsed:getType()] == nil) then  killedcounts[LastWeaponIUsed:getType()] = 1 
        else 
            killedcounts[LastWeaponIUsed:getType()] = killedcounts[LastWeaponIUsed:getType()] + 1 
        end
        
        local category = GetWeaponCategoryFromWeapon(LastWeaponIUsed);
        if(category) then
            if(killedcatcounts[category] == nil) then  killedcatcounts[category] = 1 
            else 
                killedcatcounts[category] = killedcatcounts[category] + 1 
            end
        end
        
        if(not MyAchievementManager:isComplete("Axin")) and (killedcatcounts["Axe"] ~= nil) and (killedcatcounts["Axe"] >= 300) then MyAchievementManager:setComplete("Axin",true) end
        if(not MyAchievementManager:isComplete("SmallBlade")) and (killedcatcounts["SmallBlade"] ~= nil) and (killedcatcounts["SmallBlade"] >= 500) then MyAchievementManager:setComplete("SmallBlade",true) end
        if(not MyAchievementManager:isComplete("SmallBlunt")) and (killedcatcounts["SmallBlunt"] ~= nil) and (killedcatcounts["SmallBlunt"] >= 500) then MyAchievementManager:setComplete("SmallBlunt",true) end
        if(not MyAchievementManager:isComplete("Blade")) and (killedcatcounts["LongBlade"] ~= nil) and (killedcatcounts["LongBlade"] >= 500) then MyAchievementManager:setComplete("Blade",true) end
        if(not MyAchievementManager:isComplete("Blunt")) and (killedcatcounts["Blunt"] ~= nil) and (killedcatcounts["Blunt"] >= 500) then MyAchievementManager:setComplete("Blunt",true) end
        if(not MyAchievementManager:isComplete("Inspeared")) and (killedcatcounts["Spear"] ~= nil) and (killedcatcounts["Spear"] >= 500) then MyAchievementManager:setComplete("Inspeared",true) end
        if(not MyAchievementManager:isComplete("Unarmed")) and (killedcatcounts["Unarmed"] ~= nil) and (killedcatcounts["Unarmed"] >= 500) then MyAchievementManager:setComplete("Unarmed",true) end
        if(not MyAchievementManager:isComplete("Hunter")) and (killedcounts["HuntingRifle"] ~= nil) and (killedcounts["HuntingRifle"] >= 100) then MyAchievementManager:setComplete("Hunter",true) end--MSR788 Rifle
        if(not MyAchievementManager:isComplete("PencilKill")) and (killedcounts["Pencil"] ~= nil or killedcounts["Pen"] ~= nil or killedcounts["BluePen"] ~= nil or killedcounts["RedPen"] ~= nil) then MyAchievementManager:setComplete("PencilKill",true) end
        if(not MyAchievementManager:isComplete("AllPenKill")) and (killedcounts["Pencil"] ~= nil and killedcounts["Pen"] ~= nil and killedcounts["BluePen"] ~= nil and killedcounts["RedPen"] ~= nil) then MyAchievementManager:setComplete("AllPenKill",true) end
        if(not MyAchievementManager:isComplete("ForkKill"))  and (killedcounts["Fork"] ~= nil) then MyAchievementManager:setComplete("ForkKill",true) end
    end
    
end
Events.OnZombieDead.Add(AchievementOnZombieDead)

--function AchievementOnZombieUpdate(zombie)
    
--    zombie:Say(tostring(zombie:getCurrentState()))
    
--end
--Events.OnZombieUpdate.Add(AchievementOnZombieUpdate);



function AchievementLevelPerk(player,perk,level)
    if( not player:isLocalPlayer()) then return false end
    if(MyAchievementManager ~= nil) then
        if(not MyAchievementManager:isComplete("level1")) and (level >= 1) then MyAchievementManager:setComplete("level1",true) end
        if(not MyAchievementManager:isComplete("level2")) and (level >= 10) then MyAchievementManager:setComplete("level2",true) end
    end
end
Events.LevelPerk.Add(AchievementLevelPerk)



